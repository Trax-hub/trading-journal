<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABS Trading Manager & Monte Carlo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        dark: '#0f172a',
                        card: '#1e293b',
                        success: '#10b981',
                        danger: '#ef4444',
                        accent: '#3b82f6',
                        warning: '#f59e0b',
                        text: '#94a3b8'
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #0f172a; color: #f8fafc; font-family: 'Inter', sans-serif; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); }
        .modal-backdrop { background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(4px); }
        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        
        /* Range Slider Styling */
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #3b82f6; margin-top: -6px; cursor: pointer; box-shadow: 0 0 10px rgba(59,130,246,0.5); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: #334155; border-radius: 2px; }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Navigation -->
    <nav class="border-b border-gray-800 bg-card px-6 py-4 flex justify-between items-center sticky top-0 z-40">
        <div class="flex items-center gap-3">
            <i class="fa-solid fa-chart-line text-accent text-2xl"></i>
            <h1 class="text-xl font-bold tracking-wide text-white">TRADING <span class="text-accent">MANAGER</span></h1>
        </div>
        <div class="flex gap-3">
            <button onclick="exportData()" class="hidden md:block px-4 py-2 text-xs bg-gray-700 hover:bg-gray-600 rounded text-white transition">
                <i class="fa-solid fa-download mr-2"></i>Backup
            </button>
            <label class="hidden md:block px-4 py-2 text-xs bg-gray-700 hover:bg-gray-600 rounded text-white transition cursor-pointer">
                <i class="fa-solid fa-upload mr-2"></i>Restore
                <input type="file" id="importFile" class="hidden" onchange="importData(this)">
            </label>
            <button onclick="openModal()" class="px-4 py-2 text-xs bg-accent hover:bg-blue-600 rounded text-white font-bold transition shadow-lg shadow-blue-500/20">
                <i class="fa-solid fa-plus mr-2"></i>Add Trade
            </button>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 p-6 grid grid-cols-1 xl:grid-cols-4 gap-6 max-w-[1920px] mx-auto w-full">
        
        <!-- Left Column: Stats -->
        <div class="xl:col-span-1 space-y-6">
            <div class="glass-panel rounded-xl p-6 shadow-lg relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10"><i class="fa-solid fa-wallet text-6xl text-white"></i></div>
                <h3 class="text-text text-sm font-medium uppercase">Net Profit</h3>
                <p id="total-profit" class="text-4xl font-bold mt-2 text-white">$0.00</p>
                <div class="mt-4 flex items-center gap-2 text-sm">
                    <span id="profit-factor" class="px-2 py-1 rounded bg-gray-700 text-white">PF: 0.0</span>
                </div>
            </div>

            <div class="glass-panel rounded-xl p-6 shadow-lg">
                <h3 class="text-text text-sm font-medium uppercase mb-4">Win Rate</h3>
                <div class="flex items-center justify-between">
                    <div class="relative w-24 h-24">
                        <canvas id="winrateChart"></canvas>
                        <div class="absolute inset-0 flex items-center justify-center flex-col">
                            <span id="winrate-text" class="text-lg font-bold text-white">0%</span>
                        </div>
                    </div>
                    <div class="space-y-2 text-right">
                        <p class="text-sm"><span class="text-success font-bold" id="total-wins">0</span> Wins</p>
                        <p class="text-sm"><span class="text-danger font-bold" id="total-losses">0</span> Losses</p>
                        <p class="text-sm"><span class="text-gray-400 font-bold" id="total-be">0</span> BE</p>
                    </div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="glass-panel rounded-xl p-4 text-center">
                    <p class="text-text text-xs uppercase">Avg Win</p>
                    <p id="avg-win" class="text-success font-bold text-lg">$0</p>
                </div>
                <div class="glass-panel rounded-xl p-4 text-center">
                    <p class="text-text text-xs uppercase">Avg Loss</p>
                    <p id="avg-loss" class="text-danger font-bold text-lg">$0</p>
                </div>
                <div class="glass-panel rounded-xl p-4 text-center">
                    <p class="text-text text-xs uppercase">Trades</p>
                    <p id="total-trades" class="text-white font-bold text-lg">0</p>
                </div>
                <div class="glass-panel rounded-xl p-4 text-center">
                    <p class="text-text text-xs uppercase">Expectancy</p>
                    <p id="expectancy" class="text-accent font-bold text-lg">$0</p>
                </div>
            </div>

             <div class="glass-panel rounded-xl p-4 shadow-lg">
                <h3 class="text-text text-sm font-medium uppercase mb-3">Setup Grading</h3>
                <div class="overflow-y-auto max-h-[200px]">
                    <table class="w-full text-sm text-left text-gray-400">
                        <thead class="text-xs text-gray-500 uppercase border-b border-gray-700 sticky top-0 bg-card">
                            <tr><th class="pb-2">Grade</th><th class="pb-2 text-right">P/L</th><th class="pb-2 text-right">Win%</th></tr>
                        </thead>
                        <tbody id="grade-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Right Column: Charts, Logs & Monte Carlo -->
        <div class="xl:col-span-3 space-y-6 flex flex-col">
            
            <!-- Charts Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 glass-panel rounded-xl p-6 shadow-lg">
                    <h3 class="text-text text-sm font-medium uppercase mb-4">Equity Curve</h3>
                    <div class="relative h-64 w-full"><canvas id="equityChart"></canvas></div>
                </div>
                <div class="glass-panel rounded-xl p-6 shadow-lg">
                    <h3 class="text-text text-sm font-medium uppercase mb-4">P/L by Day</h3>
                    <div class="relative h-64 w-full"><canvas id="dayChart"></canvas></div>
                </div>
            </div>

            <!-- Trade Table -->
            <div class="glass-panel rounded-xl p-6 shadow-lg overflow-hidden flex-1 min-h-[400px]">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-text text-sm font-medium uppercase">Trade Log</h3>
                    <input type="text" id="search" placeholder="Search asset, note..." class="bg-dark border border-gray-700 text-white text-xs rounded px-3 py-1 focus:border-accent outline-none transition w-48 focus:w-64">
                </div>
                <div class="overflow-x-auto max-h-[400px]">
                    <table class="w-full text-sm text-left text-gray-400">
                        <thead class="text-xs text-gray-500 uppercase bg-gray-800 sticky top-0 z-10">
                            <tr>
                                <th class="px-4 py-3">Date</th>
                                <th class="px-4 py-3">Bias</th>
                                <th class="px-4 py-3">Setup</th>
                                <th class="px-4 py-3 text-right">P/L</th>
                                <th class="px-4 py-3 text-center">Img</th>
                                <th class="px-4 py-3">Note</th>
                                <th class="px-4 py-3 text-center">Action</th>
                            </tr>
                        </thead>
                        <tbody id="trades-table-body" class="divide-y divide-gray-800"></tbody>
                    </table>
                </div>
            </div>

            <!-- MONTE CARLO SIMULATION -->
            <div class="glass-panel rounded-xl p-6 shadow-lg border-t-4 border-accent">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 gap-4">
                    <div>
                        <h2 class="text-lg font-bold text-white flex items-center gap-2">
                            <i class="fa-solid fa-flask text-accent"></i> Prop Firm Monte Carlo Simulator
                        </h2>
                        <p class="text-xs text-gray-400 mt-1">
                            Evaluation 50k | Target: $53k | Trailing DD: $2k | Max Daily Loss: $1k | Max Daily Gain: $1.5k
                        </p>
                    </div>
                    
                    <div class="flex items-center gap-4 bg-dark p-3 rounded-lg border border-gray-700">
                        <div class="text-right">
                            <label class="block text-xs text-gray-400 font-bold uppercase">Risk per Trade</label>
                            <span id="riskDisplay" class="text-accent font-bold text-lg">0.50%</span>
                        </div>
                        <input type="range" id="riskSlider" min="0.1" max="2.0" step="0.05" value="0.50" class="w-32" oninput="runMonteCarlo()">
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                    <!-- Simulation Stats -->
                    <div class="lg:col-span-1 grid grid-cols-2 lg:grid-cols-1 gap-4">
                        <div class="bg-card p-4 rounded-lg border border-gray-700 text-center">
                            <p class="text-xs text-gray-400 uppercase">Pass Probability</p>
                            <p id="sim-pass-rate" class="text-3xl font-bold text-white mt-1">--%</p>
                        </div>
                        <div class="bg-card p-4 rounded-lg border border-gray-700 text-center">
                            <p class="text-xs text-gray-400 uppercase">Avg Time to Pass</p>
                            <p id="sim-avg-days" class="text-xl font-bold text-accent mt-1">-- Days</p>
                        </div>
                        <div class="bg-card p-4 rounded-lg border border-gray-700 text-center col-span-2 lg:col-span-1">
                            <p class="text-xs text-gray-400 uppercase">Median Outcome</p>
                            <p id="sim-median-pl" class="text-lg font-bold text-white mt-1">$0</p>
                        </div>
                    </div>

                    <!-- Simulation Chart -->
                    <div class="lg:col-span-3">
                        <div class="relative h-64 w-full">
                            <canvas id="monteCarloChart"></canvas>
                        </div>
                        <div class="flex justify-center gap-6 mt-2 text-xs text-gray-400">
                            <span class="flex items-center gap-1"><div class="w-3 h-3 bg-green-500 rounded-full"></div> Best 5%</span>
                            <span class="flex items-center gap-1"><div class="w-3 h-3 bg-blue-500 rounded-full"></div> Median</span>
                            <span class="flex items-center gap-1"><div class="w-3 h-3 bg-red-500 rounded-full"></div> Worst 5%</span>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- Add Trade Modal -->
    <div id="tradeModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50 transition-opacity">
        <div class="bg-card border border-gray-700 rounded-xl shadow-2xl w-full max-w-lg p-6 m-4 transform transition-all scale-100">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white">Add New Trade</h2>
                <button onclick="closeModal()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            
            <form id="tradeForm" class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs text-gray-400 mb-1">Date</label>
                        <input type="date" id="inpDate" required class="w-full bg-dark border border-gray-600 rounded p-2 text-white text-sm focus:border-accent outline-none">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-400 mb-1">Net P/L ($)</label>
                        <input type="number" id="inpPL" step="0.01" required class="w-full bg-dark border border-gray-600 rounded p-2 text-white text-sm focus:border-accent outline-none" placeholder="-250 or 500">
                    </div>
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <div>
                        <label class="block text-xs text-gray-400 mb-1">Bias</label>
                        <select id="inpBias" class="w-full bg-dark border border-gray-600 rounded p-2 text-white text-sm focus:border-accent outline-none">
                            <option value="BULL">BULL</option>
                            <option value="BEAR">BEAR</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs text-gray-400 mb-1">Type</label>
                        <select id="inpType" class="w-full bg-dark border border-gray-600 rounded p-2 text-white text-sm focus:border-accent outline-none">
                            <option value="Long">Long</option>
                            <option value="Short">Short</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-xs text-gray-400 mb-1">Grade</label>
                        <select id="inpGrade" class="w-full bg-dark border border-gray-600 rounded p-2 text-white text-sm focus:border-accent outline-none">
                            <option value="A">A</option>
                            <option value="A-">A-</option>
                            <option value="B+">B+</option>
                            <option value="B">B</option>
                            <option value="C">C</option>
                        </select>
                    </div>
                </div>

                <div>
                    <label class="block text-xs text-gray-400 mb-1">Setup Name</label>
                    <input type="text" id="inpSetup" class="w-full bg-dark border border-gray-600 rounded p-2 text-white text-sm focus:border-accent outline-none" value="SMT + IOB m1">
                </div>

                <div>
                    <label class="block text-xs text-gray-400 mb-1">Screenshot URL</label>
                    <input type="text" id="inpLink" class="w-full bg-dark border border-gray-600 rounded p-2 text-white text-sm focus:border-accent outline-none" placeholder="https://tradingview.com/x/...">
                </div>

                <div>
                    <label class="block text-xs text-gray-400 mb-1">Notes</label>
                    <textarea id="inpNote" rows="3" class="w-full bg-dark border border-gray-600 rounded p-2 text-white text-sm focus:border-accent outline-none" placeholder="Confluences, psychology..."></textarea>
                </div>

                <button type="submit" class="w-full bg-accent hover:bg-blue-600 text-white font-bold py-2 rounded transition">
                    Save Trade
                </button>
            </form>
        </div>
    </div>

    <script>
        // --- INITIAL CSV DATA (Backup) ---
        const initialCsvData = `Date,Asset,Entry Time,Day of Week,BIAS,Long/Short,Net P/L,Pts,SL SIZE,Setup,NET RR,Risk,Rules Followed?,Screenshot,Entry Confirmations / Notes,Note,bot/top catch,too prem/disc?,enough confluences?,PSYCHOLOGY,Comment,Late Observations
10-1-24,NQ,10:19:00 PM,Tues,BEAR,Short,$0,0pts,13.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/ez8Dz3Dg,"internal smt... targeting asial... A BE moved early...",A,NO,NO,YES,,,
10-2-24,NQ,11:02:00 AM,Weds,BULL,Long,$0,0pts,39pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/GdUQGkRW,"internal smt 2x... targeting h1 bsl... A-",A-,NO,YES,YES,"BE AND RAN TO FULL TP",,
10-3-24,NQ,3:36:00 AM,Thurs,BEAR,Short,$0,0pts,12.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/jVMoRXYQ,"internal smt... targeting pdl... B",B,NO,NO,YES,,,
10-3-24,NQ,4:29:00 AM,Thurs,BEAR,Short,-$250,-17.75pts,17.75pts,SMT + IOB m1,1:3,0.50%,YES,https://www.tradingview.com/x/52SD0qiY,"internal smt... targeting m15 ssl... A",A,NO,NO,YES,,,avoidable cause not in any PD array
10-3-24,NQ,5:41:00 AM,Thurs,BEAR,Short,$0,0pts,10.75pts,SMT + IOB m1,1:5,0.50%,YES,https://www.tradingview.com/x/9l9PeSFb,"internal smt m5 high... tagreting m15 ssl... A",A,NO,NO,YES,,,
10-3-24,NQ,7:21:00 AM,Thurs,BULL,Long,$500,16.5pts,8.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/m9o4e4C2,"internal smt... targeting m15 bsl... A",A,NO,NO,YES,,,
10-3-24,NQ,10:32:00 AM,Thurs,BULL,Long,-$250,-52.25pts,52.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/KNfdV1zT,"internal smt m15 low... targeting m15 bsl... A",A,NO,NO,YES,,,
10-4-24,NQ,1:52:00 AM,Fri,BULL,Long,-$250,-16.5pts,16.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/hO2vfk6s,"internal smt... targeting m15 bsl... A",A,NO,NO,YES,,,
10-4-24,NQ,3:50:00 AM,Fri,BULL,Long,-$250,-19.5pts,19.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/0oxNxCIM,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
10-4-24,NQ,5:27:00 AM,Fri,BULL,Long,$500,28.5pts,14.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/AH2pU8Nh,"internal smt... targeting london high... B",B,NO,NO,YES,,,
10-8-24,NQ,4:17:00 AM,Tues,BULL,Long,-$250,-23pts,23pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/XUSwXnJI,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
10-9-24,NQ,1:47:00 AM,Weds,BULL,Long,-$250,-23.5pts,23.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/r22uTGIJ,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
10-9-24,NQ,2:41:00 AM,Weds,BULL,Long,$0,0pts,10.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/Eggw2Z4v,"internal smt... targeting m15 bsl... A",A,NO,NO,YES,,,
10-9-24,NQ,3:33:00 AM,Weds,BULL,Long,$0,0pts,20.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/pEFbipod,"internal smt... targeting h1 fvg- ... A",A,NO,NO,YES,"BE AND RAN TO FULL TP",,
10-9-24,NQ,7:45:00 AM,Weds,BULL,Long,-$250,-17.25pts,17.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/JGOZBkJJ,"internal smt... targeting pdh... A",A,NO,NO,YES,,,avoidable
10-9-24,NQ,10:56:00 AM,Weds,BULL,Long,$500,39.5pts,19.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/PSb1zECJ,"internal smt... targeting h4 bsl... A-",A-,NO,NO,YES,,,
10-11-24,NQ,4:34:00 AM,Fri,BULL,Long,-$250,-21pts,21pts,SMT + IOB m1,1:3,0.50%,YES,https://www.tradingview.com/x/rj1SeZrq,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
10-11-24,NQ,5:02:00 AM,Fri,BULL,Long,$0,0pts,19.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/JTjctGdm,"internal smt... targeting m15 bsl... A",A,NO,NO,YES,,,
10-14-24,NQ,1:53:00 AM,Monday,BULL,Long,$0,0pts,8.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/gmrblGGH,"internal smt... targeting asiah... A",A,NO,NO,NO,,,
10-14-24,NQ,3:09:00 AM,Monday,BULL,Long,$500,14.5pts,7.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/DWIexapD,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
10-14-24,NQ,4:05:00 AM,Monday,BULL,Long,$0,0pts,5.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/mFkiY12h,"internal smt... targeting pdh... A",A,NO,NO,YES,"BE AND RAN",,
10-14-24,NQ,7:17:00 AM,Monday,BULL,Long,$0,0pts,6.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/hgRKImmx,"internal smt... targeting london high... A",A,NO,NO,YES,"BE AND RAN",,
10-14-24,NQ,10:12:00 PM,Monday,BULL,Long,-$250,-5.5pts,5.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/c7tHe1xU,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
10-15-24,NQ,2:36:00 AM,Tues,BULL,Long,$500,14pts,7pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/DKUX6mw8,"internal smt... targeting m15 fvg-... A",A,NO,NO,YES,,,
10-15-24,NQ,3:09:00 AM,Tues,BULL,Long,$0,0pts,13pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/oGFBO3jA,"internal smt... targeting m15 ob-... A",A,NO,NO,YES,,,
10-15-24,NQ,4:43:00 AM,Tues,BULL,Long,$0,0pts,14.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/RqP1IMBm,"internal smt... targeting london high... A",A,NO,NO,YES,,,
10-15-24,NQ,7:23:00 AM,Tues,BULL,Long,-$250,-10.25pts,10.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/wajlG9MP,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
10-15-24,NQ,10:27:00 AM,Tues,BULL,Long,-$250,-21.25pts,21.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/TZJve2GR,"internal smt... targeting m15 brkr-... A",A,NO,NO,YES,,,
10-16-24,NQ,7:57:00 AM,Weds,BULL,Long,-$250,-6.5pts,6.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/enLufYC5,"internal smt... targeting london high... A-",A,NO,NO,NO,,,
10-16-24,NQ,10:04:00 AM,Weds,BULL,Long,$0,0pts,51.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/GVZlw0Ph,"internal smt... targeting m5 ob-... A",A,NO,NO,YES,,,
10-17-24,NQ,3:26:00 AM,Thurs,BULL,Long,$500,51.5pts,25.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/F2ER4jFx,"internal smt... targeting h1 bsl... A-",A-,NO,YES,NO,,,
10-17-24,NQ,5:49:00 AM,Thurs,BULL,Long,$500,37.5pts,18.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/jsCwTV5v,"internal smt... targeting h4 fvg-... B",B,NO,NO,NO,,,
10-17-24,NQ,10:14:00 AM,Thurs,BULL,Long,$0,0pts,48pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/HOIrDVxv,"internal smt... targeting london high... A",A,NO,NO,YES,,,
10-17-24,NQ,10:24:00 PM,Thurs,BULL,Long,$500,16pts,8pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/ILc0pokV,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
10-18-24,NQ,5:48:00 AM,Fri,BULL,Long,-$250,-10.75pts,10.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/GsU7QGQ9,"internal smt... targeting london high... A-",A-,NO,YES,YES,,,
10-22-24,NQ,2:20:00 AM,Tues,BULL,Long,-$250,-8.5pts,8.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/toXoAVxH,"internal smt... targeting h1 fvg-... A",A,NO,YES,YES,,,
10-22-24,NQ,4:01:00 AM,Tues,BULL,Long,-$250,-14.75pts,14.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/ehctniWZ,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
10-22-24,NQ,5:35:00 AM,Tues,BULL,Long,-$250,-18.75pts,18.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/AJPZ4T8l,"internal smt... targeting h1 fvg-... B",B,YES,NO,NO,,,
10-23-24,NQ,4:55:00 AM,Weds,BULL,Long,$0,0pts,6.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/NyujRGLz,"internal smt... targeting london high... A",A,NO,NO,YES,,,
10-23-24,NQ,10:20:00 AM,Weds,BULL,Long,$0,0pts,47.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/O2wrwCso,"internal smt... targeting london high... B",B,NO,NO,YES,,,
10-22-24,NQ,11:20:00 PM,Thurs,BULL,Long,-$250,-9pts,9pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/duYWKcyB,"internal smt... targeting asiah... B",B,NO,NO,YES,,,
10-28-24,NQ,12:06:00 AM,Monday,BULL,Long,$500,30pts,15pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/ZQ5BVu0o,"internal smt... targeting m15 fvg-... B",B,YES,NO,YES,,,
10-29-24,NQ,3:15:00 AM,Tues,BULL,Long,$0,0pts,10pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/b127XDMH,"internal smt... targeting h1 bsl... B",B,NO,YES,NO,,,
10-29-24,NQ,12:34:00 AM,Tues,BULL,Long,-$250,-15.75pts,15.75pts,SMT + IOB m1,1:3,0.50%,YES,https://www.tradingview.com/x/6fHKq19S,"internal smt... targeting asiah... B",B,YES,NO,YES,,,
10-30-24,NQ,3:05:00 AM,Weds,BULL,Long,$0,0pts,13.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/fV2XqhNP,"internal smt... targeting asiah... B",B,NO,YES,YES,,,
10-30-24,NQ,4:48:00 AM,Weds,BULL,Long,$0,0pts,9.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/BanxqLDL,"internal smt... targeting london high... A",A,NO,NO,YES,,,
10-31-24,NQ,1:44:00 AM,Thurs,BEAR,Short,$500,18pts,9pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/eUhQLME7,"internal smt... targeting h1 ssl... B",B,NO,NO,NO,,,
10-31-24,NQ,3:43:00 AM,Thurs,BEAR,Short,$500,28pts,14pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/bJLSsPg3,"internal smt... targeting h4 ssl... A",A,NO,NO,YES,,,
10-31-24,NQ,7:42:00 AM,Thurs,BULL,Long,$500,29pts,14.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/nbvg0NLg,"internal smt... targeting h1 fvg-... A",A,NO,NO,NO,,,
11-4-24,NQ,3:12:00 AM,Monday,BULL,Long,-$250,-22.25pts,22.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/Mcn3FN7q,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
11-5-24,NQ,10:36:00 AM,Tues,BULL,Long,-$250,-31pts,31pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/znTQkoRb,"internal smt... targeting h4 bsl... B",B,NO,YES,NO,,,
11-7-24,NQ,2:20:00 AM,Thurs,BULL,Long,-$250,-12.75pts,12.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/UmcnodBH,"internal smt... targeting ath... B",B,NO,YES,NO,,,
11-7-24,NQ,10:11:00 PM,Thurs,BULL,Long,$500,18.5pts,9.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/amwBuFFK,"internal smt... targeting asiah... B",B,NO,YES,YES,,,
11-8-24,NQ,5:58:00 AM,Fri,BULL,Long,-$250,-16pts,16pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/KR10ElDv,"internal smt... targeting m15 fvg-... B",B,YES,NO,YES,,,
11-8-24,NQ,10:16:00 AM,Fri,BULL,Long,$0,0pts,20pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/TfKKpmVH,"internal smt... targeting NYAM high... A",A,NO,NO,NO,"BE AND RAN",,
11-11-24,NQ,1:19:00 AM,Monday,BULL,Long,-$250,-13.75pts,13.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/ZbFE8R5i,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
11-13-24,NQ,4:31:00 AM,Weds,BULL,Long,-$250,-12pts,12pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/wVm9NhzM,"internal smt... targeting asiah... B",B,NO,YES,YES,,,
11-13-24,NQ,6:14:00 AM,Weds,BULL,Long,$0,0pts,6.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/qFmx57Nx,"internal smt... targeting m15 fvg-... A",A,NO,NO,YES,,,
11-14-24,NQ,1:20:00 AM,Thurs,BULL,Long,$500,21.5pts,10.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/lmLtlf5o,"internal smt... targeting pdl... B",B,NO,NO,YES,,,
11-14-24,NQ,5:01:00 AM,Thurs,BULL,Long,-$250,-8pts,8pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/KfLLaLjn,"internal smt... targeting london high... A",A,NO,YES,YES,,,
11-14-24,NQ,5:12:00 AM,Thurs,BULL,Long,$0,0pts,11.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/s2wKWWDJ,"internal smt... targeting london high... A",A,NO,YES,YES,,,
11-15-24,NQ,7:16:00 AM,Fri,BULL,Long,$0,0pts,12.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/wrsRRwsP,"internal smt... targeting m15 ob+... A",A,NO,NO,YES,,,
11-18-24,NQ,3:11:00 AM,Monday,BULL,Long,$500,17.5pts,8.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/gZl6fjOW,"internal smt... targeting london high... B",B,YES,YES,NO,,,
11-21-24,NQ,6:46:00 AM,Thurs,BULL,Long,$500,64pts,32pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/BXZvN9nG,"internal smt... targeting asiah... B",B,NO,YES,NO,,,
11-22-24,NQ,10:23:00 AM,Fri,BULL,Long,-$250,-42.25pts,42.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/mGaVwivq,"internal smt... targeting NYAM high... A-",A-,NO,NO,YES,,,
11-26-24,NQ,3:17:00 AM,Tues,BULL,Long,-$250,-25.25pts,25.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/ENE1krTt,"internal smt... targeting asiah... A-",A-,NO,YES,YES,,,
11-26-24,NQ,10:45:00 PM,Tues,BULL,Long,-$250,-9.5pts,9.5pts,SMT + IOB m1,1:3,0.50%,YES,https://www.tradingview.com/x/eLEfBXTT,"internal smt... targeting asiah... B",B,NO,NO,NO,,,
11-27-24,NQ,12:25:00 AM,Weds,BULL,Long,$0,0pts,13.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/6RFi0gXL,"internal smt... targeting m15 fvg-... A-",A-,YES,NO,YES,,,
11-27-24,NQ,3:48:00 AM,Weds,BULL,Long,-$250,-18.5pts,18.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/8foEK9Mx,"internal smt... targeting london high... B",B,YES,NO,NO,,,
12-3-24,NQ,10:33:00 AM,Tues,BULL,Long,-$250,-27.5pts,27.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/rrgbsjMh,"internal smt... targeting pdh... B",B,NO,NO,NO,,,
12-4-24,NQ,4:44:00 AM,Thurs,BULL,Long,$500,24pts,12pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/03HgHbpy,"internal smt... targeting ath... B",B,NO,NO,YES,,,
12-6-24,NQ,6:50:00 AM,Fri,BULL,Long,$500,24.5pts,12.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/xwAKiro6,"internal smt... targeting m15 fvg-... B+",B+,YES,NO,YES,,,
12-9-24,NQ,3:37:00 AM,Monday,BULL,Long,-$250,-11pts,11pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/u2yJu3Wr,"internal smt... targeting ath... A",A,NO,NO,YES,,,
12-10-24,NQ,7:18:00 AM,Tues,BULL,Long,$500,13pts,6.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/OWvDJAMM,"internal smt... targeting h1 bsl... B",B,NO,YES,YES,,,
12-10-24,NQ,11:07:00 PM,Tues,BULL,Long,-$250,-4.75pts,4.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/QNCrfzFL,"internal smt... targeting asiah... A-",A-,NO,NO,YES,,,
12-11-24,NQ,12:48:00 AM,Weds,BULL,Long,$500,11.5pts,5.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/skE1WPvf,"internal smt... targeting asiah... A-",A-,NO,NO,YES,,,
12-12-24,NQ,5:23:00 AM,Thurs,BULL,Long,$0,0pts,9.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/f7hiwV9R,"internal smt... targeting m15 fvg-... B",B,YES,NO,YES,,,
12-12-24,NQ,7:06:00 AM,Thurs,BULL,Long,-$250,-9.75pts,9.75pts,SMT + IOB m1,1:4,0.50%,YES,https://www.tradingview.com/x/R0Uwaip8,"internal smt... targeting london high... B",B,YES,NO,YES,,,
12-13-24,NQ,2:22:00 AM,Fri,BULL,Long,$650,31.5pts,12.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/kN5XKI52,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
12-13-24,NQ,10:13:00 AM,Fri,BULL,Long,-$250,-59pts,59pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/a9pUkeh4,"internal smt... targeting ath... A",A,NO,NO,YES,,,
12-15-24,NQ,10:23:00 PM,Sun,BULL,Long,$0,0pts,6pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/rouDGILD,"internal smt... targeting ath... B",B,NO,NO,YES,,,
12-16-24,NQ,12:06:00 AM,Monday,BULL,Long,-$250,-6pts,6pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/UYbl057n,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
12-16-24,NQ,6:30:00 AM,Monday,BULL,Long,$500,27pts,13.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/fp7uS7oR,"internal smt... targeting ath... A",A,NO,NO,YES,,,
12-16-24,NQ,10:24:00 AM,Monday,BULL,Long,$500,93pts,46.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/xWA5Jdkv,"internal smt... targeting ath... A",A,NO,NO,YES,,,
12-17-24,NQ,12:28:00 AM,Tues,BULL,Long,-$250,-7.25pts,7.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/8jGbGsgd,"internal smt... targeting asiah/ath... A",A,NO,NO,YES,,,
12-17-24,NQ,6:17:00 AM,Tues,BULL,Long,-$250,-19.5pts,19.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/NHOURpOY,"internal smt... targeting ath asiah... A",A,NO,NO,YES,,,
12-17-24,NQ,10:37:00 PM,Tues,BULL,Long,$500,27pts,13.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/cuHOwVej,"internal smt... targeting ath... A",A,NO,NO,YES,,,
12-18-24,NQ,5:57:00 AM,Weds,BULL,Long,$0,0pts,13.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/jkggXuEs,"internal smt... targeting ath... A-",A-,NO,YES,NO,,,
12-19-24,NQ,4:30:00 AM,Thurs,BULL,Long,$500,35pts,17.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/PrkDgweH,"internal smt... targeting m15 bsl... B",B,NO,NO,YES,,,
12-19-24,NQ,6:01:00 AM,Thurs,BULL,Long,-$250,-22pts,22pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/h7gYMaLw,"internal smt... targeting m15 bsl... B",B,NO,YES,YES,,,
12-20-24,NQ,2:42:00 AM,Fri,BULL,Long,-$250,-6pts,6pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/V4yJU2zq,"internal smt... targeting m15 fvg-... B",B,NO,NO,YES,,,
12-24-24,NQ,4:34:00 AM,Tues,BULL,Long,$0,0pts,15.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/QMkPb79g,"internal smt... targeting h1 bsl... A-",A-,NO,YES,NO,,,
12-24-24,NQ,10:30:00 AM,Tues,BULL,Long,$500,66.5pts,33.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/WNql7jNo,"internal smt... targeting h4 fvg- CE... B",B,NO,YES,YES,,,
12-27-24,NQ,2:08:00 AM,Fri,BEAR,Short,$0,0pts,8.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/zV8pCoQg,"internal smt... taregting pdl... A-",A-,NO,YES,YES,,,
12-27-24,NQ,11:01:00 AM,Fri,BEAR,Short,$0,0pts,29.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/UjXrAOCq,"internal smt... targeting h4 ssl... B",B,NO,NO,YES,,,
1-2-25,NQ,3:17:00 AM,Thurs,BEAR,Short,$500,60.1pts,30.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/WhcwJikr,"internal smt... targeting m15 fvg+... B",B,YES,NO,YES,,,
1-3-25,NQ,4:40:00 AM,Fri,BULL,Long,-$250,-14.5pts,14.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/BG5tfbmE,"internal smt... targeting h1 ob-... B",B,NO,YES,YES,,,
1-6-25,NQ,1:24:00 AM,Monday,BULL,Long,$0,0pts,11.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/51swrDn9,"internal smt... targeting pdh... B",B,NO,NO,YES,,,
1-6-25,NQ,10:13:00 AM,Monday,BULL,Long,$0,0pts,58.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/pO7WmS9h,"internal smt... targeting h4 bsl... A-",A-,NO,YES,YES,,,
1-8-25,NQ,10:08:00 AM,Weds,BEAR,Short,$0,0pts,54.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/f8UPXcZ2,"internal smt... targeting h4 ssl... A",A,NO,NO,YES,,,
1-9-25,NQ,1:15:00 AM,Thurs,BEAR,Short,$0,0pts,9.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/8RrsDkCK,"internal smt... targeting asial... A",A,NO,NO,YES,,,
1-9-25,NQ,5:50:00 AM,Thurs,BULL,Long,-$250,-15pts,15pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/qBCw53cn,"internal smt... targeting asiah... B",B,NO,YES,YES,,,
1-9-25,NQ,6:15:00 AM,Thurs,BULL,Long,-$250,-18.5pts,18.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/sGsI1hir,"internal smt... targeting asiah... A-",A-,NO,NO,YES,,,
1-13-25,NQ,12:06:00 AM,Monday,BEAR,Short,$0,0pts,9pts,SMT + IOB m1,1:3,0.50%,YES,https://www.tradingview.com/x/POSzbwk8,"internal smt... targeting asial... A",A,NO,NO,YES,,,
1-13-25,NQ,4:44:00 AM,Monday,BEAR,Short,-$250,-33.5pts,33.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/jbElvtwt,"internal smt... targeting h4 ssl... A",A,NO,NO,YES,,,
1-14-25,NQ,12:34:00 AM,Tues,BULL,Long,$0,0pts,11.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/GCZfKtJs,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
1-15-25,NQ,12:16:00 AM,Weds,BULL,Long,$0,0pts,12pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/sia5weEd,"internal smt... targeting m15 bsl... A-",A-,NO,YES,YES,,,
1-16-25,NQ,1:10:00 AM,Thurs,BULL,Long,$500,49.5pts,24.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/luo73MbK,"internal smt... targeting asiah... B",B,YES,NO,YES,,,
1-16-25,NQ,3:34:00 AM,Thurs,BULL,Long,$0,0pts,22.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/FaSGJkNb,"internal smt... targeting london high... B",B,NO,YES,YES,,,
1-16-25,NQ,6:51:00 AM,Thurs,BULL,Long,-$250,-23.75pts,23.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/lyAC4g5x,"internal smt... targeting london high... A",A,NO,NO,YES,,,
1-17-25,NQ,2:20:00 AM,Fri,BULL,Long,-$250,-10.25pts,10.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/BBhCcbxI,"internal smt... targeting m15 bsl... A-",A-,NO,NO,YES,,,
1-17-25,NQ,4:48:00 AM,Fri,BULL,Long,-$250,-10.75pts,10.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/zK7v2NIt,"internal smt... targeting h1 bsl... B",B,NO,YES,YES,,,
1-17-25,NQ,10:29:00 AM,Fri,BULL,Long,$500,94.5pts,47.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/20ksVdvc,"internal smt... targeting NYAM high... A",A,NO,NO,YES,,,
1-21-25,NQ,2:04:00 AM,Tues,BULL,Long,$500,43.5pts,21.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/YoQdUhp3,"internal smt... targeting m15 bsl... B",B,NO,NO,YES,,,
1-22-25,NQ,1:35:00 AM,Weds,BULL,Long,-$250,-5.75pts,5.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/Tk0xcsXh,"internal smt... targeting asiah... B",B,NO,YES,YES,,,
1-22-25,NQ,2:05:00 AM,Weds,BULL,Long,$500,15pts,7.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/l21oNTbb,"internal smt... targeting m15 ob-... A",A,NO,NO,YES,,,
1-23-25,NQ,6:20:00 AM,Thurs,BULL,Long,$0,0pts,14pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/kkRe714n,"internal smt... targeting h1 fvg-... B",B,YES,NO,YES,,,
1-24-25,NQ,5:49:00 AM,Fri,BULL,Long,$0,0pts,11.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/V48x9FBZ,"external smt london low... targeting london high... B",B,NO,NO,NO,,,
1-27-25,NQ,3:39:00 AM,Monday,BEAR,Short,$0,0pts,44.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/lJZnCppl,"internal smt... targeting daily fvg+... A",A,NO,NO,YES,,,
1-27-25,NQ,10:24:00 AM,Monday,BULL,Long,$0,0pts,86pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/0IpI0Wqz,"internal smt... targeting h4 fvg-... A-",A-,NO,NO,YES,,,
1-28-25,NQ,6:04:00 AM,Tues,BULL,Long,-$250,-14.5pts,14.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/Orja3sEF,"internal smt... targeting london high... A",A,NO,NO,YES,,,
1-29-25,NQ,12:08:00 PM,Weds,BULL,Long,-$250,-5.5pts,5.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/zhUAP17l,"internal smt 2x... targeting asiah... A-",A-,NO,YES,YES,,,
1-29-25,NQ,10:25:00 AM,Weds,BULL,Long,-$250,-60.25pts,60.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/cyEfON9K,"internal smt... targeting london high... B",B,YES,NO,YES,,,
1-30-25,NQ,12:46:00 AM,Thurs,BULL,Long,-$250,-14.25pts,14.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/LWSswpsg,"internal smt... targeting pdh... A-",A-,NO,YES,YES,,,
1-30-25,NQ,2:11:00 AM,Thurs,BULL,Long,"$1,125",47.25pts,10.5pts,SMT + IOB m1,1:4,0.50%,YES, https://www.tradingview.com/x/pIYPDJ0A,"internal smt... targeting asiah... B",B,YES,NO,YES,,,
1-30-25,NQ,10:48:00 PM,Thurs,BULL,Long,$0,0pts,7.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/5PhAWiNs,"internal smt... targeting asiah... A-",A-,NO,YES,YES,,,
1-30-25,NQ,11:12:00 PM,Thurs,BULL,Long,-$250,-10.25pts,10.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/DeNfp0YE,"internal smt... targeting asiah... B",B,NO,NO,YES,,,
1-30-25,NQ,11:40:00 PM,Thurs,BULL,Long,-$250,-9pts,9pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/rbFgO6IZ,"internal smt... targeting m15 bsl... B",B,YES,NO,YES,,,
1-31-25,NQ,1:04:00 AM,Fri,BULL,Long,$500,21pts,10.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/lRwAsXbS,"internal smt... targeting asiah... B",B,YES,NO,YES,,,
1-31-25,NQ,2:46:00 AM,Thurs,BULL,Long,-$250,-14.5pts,14.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/xWfrDv7f,"internal smt... targeting london high... A-",A-,NO,YES,YES,,,
2-3-25,NQ,10:25:00 PM,Monday,BULL,Long,-$250,-20.25pts,20.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/hBFDxvX6,"internal smt... targeting m15 ob-... A",A,NO,NO,YES,,,
2-5-25,NQ,10:33:00 PM,Weds,BULL,Long,$500,13.5pts,6.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/1t03XMtF,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
2-6-25,NQ,1:46:00 AM,Thurs,BULL,Long,-$250,-6.75pts,6.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/ZMZXmjjE,"internal smt... targeting m15 bsl... A-",A-,NO,YES,YES,,,
2-6-25,NQ,3:05:00 AM,Thurs,BULL,Long,$500,24.5pts,12.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/036Dqrg4,"internal smt... targeting london high... A",A,NO,NO,YES,,,
2-7-25,NQ,4:02:00 AM,Fri,BULL,Long,-$250,-13.25pts,13.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/d7ybAM5T,"internal smt 2x... targeting london high... A",A,NO,NO,YES,,,
2-7-25,NQ,4:31:00 AM,Fri,BULL,Long,$0,0pts,12.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/VGi9qGwT,"internal smt 2x... targeting london high... A--",A-,NO,NO,YES,,,
2-10-25,NQ,1:40:00 AM,Monday,BULL,Long,-$250,-8.75pts,8.75pts,SMT + IOB m1,1:4,0.50%,YES,https://www.tradingview.com/x/a3DdHtVY,"external smt m15 low... targeting m15 bsl... B",B,NO,NO,YES,,,
2-10-25,NQ,1:58:00 AM,Monday,BULL,Long,-$250,-12pts,12pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/LhahkKGX,"external smt m15 low... targeting m15 bsl... A",A,NO,NO,YES,,,
2-11-25,NQ,4:49:00 AM,Tues,BULL,Long,-$250,-15.25pts,15.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/CgdJ1oKO,"internal smt... targeting m15 bsl... A",A,NO,NO,YES,,,
2-11-25,NQ,10:09:00 AM,Tues,BULL,Long,$0,0pts,35pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/qVupjVkq,"internal smt... targeting pdh... A",A,NO,NO,YES,,,
2-12-25,NQ,2:29:00 AM,Weds,BULL,Long,$0,0pts,8pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/p4ewMJWu,"internal smt... targeting asiah... B",A,NO,NO,YES,,,
2-12-25,NQ,10:55:00 AM,Weds,BULL,Long,-$250,-42.5pts,42.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/IhwMsARy,"internal smt... targeting m15 ob-... A-",A-,NO,YES,YES,,,
2-13-25,NQ,1:07:00 AM,Thurs,BULL,Long,$0,0pts,13.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/F4pFWqak,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
2-13-25,NQ,5:12:00 AM,Thurs,BULL,Long,$0,0pts,22.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/JFOcS8Vj,"internal smt... targeting london high... A-",A-,NO,YES,YES,,,
2-13-25,NQ,10:39:00 PM,Thurs,BULL,Long,$550,13pts,6.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/7Z3rXziB,"internal smt... targeting asiah... A-",A-,NO,YES,YES,,,
2-14-25,NQ,3:21:00 AM,Fri,BULL,Long,-$250,-13.5pts,13.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/P5bFoXZx,"external smt m15 low... targeting london high... A",A,NO,NO,YES,,,
2-17-25,NQ,3:03:00 AM,Monday,BULL,Long,$0,0pts,6.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/pFwYJF7c,"internal smt m5 low... targeting m15 fvg-... A",A,NO,NO,YES,,,
2-17-25,NQ,4:55:00 AM,Monday,BULL,Long,$0,0pts,21.5pts,SMT + IOB m1,1:2,0.50%,YES, https://www.tradingview.com/x/D1PpalPO,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
2-18-25,NQ,3:56:00 AM,Tues,BULL,Long,$0,0pts,14.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/rvyL3vp4,"internal smt... targeting london high... A",A,NO,NO,YES,,,
2-18-25,NQ,10:54:00 AM,Tues,BULL,Long,-$250,-52.25pts,52.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/Py5Gq14h,"internal smt... targeting m15 fvg-... B",B,YES,NO,YES,,,
2-18-25,NQ,10:37:00 PM,Tues,BULL,Long,$0,0pts,4.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/zcBA0fJ5,"internal smt... targeting m15 bsl... A",A,NO,NO,NO,,,
2-20-25,NQ,6:13:00 AM,Thurs,BULL,Long,-$250,-7.25pts,7.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/lwPZpz3v,"internal smt... targeting london high... A",A,NO,NO,YES,,,
2-21-25,NQ,2:24:00 AM,Fri,BULL,Long,-$250,-7.75pts,7.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/geepoKCd,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
2-23-25,NQ,10:37:00 PM,Sun,BULL,Long,$500,20pts,10pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/TIZPSHb5,"internal smt 2x... targeting asiah... A-",A-,NO,YES,YES,,,
2-24-25,NQ,12:20:00 AM,Monday,BULL,Long,$0,0pts,10.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/SqPa6ysv,"internal smt... targeting asiah... A-",A-,NO,YES,YES,,,
2-25-25,NQ,1:58:00 AM,Monday,BULL,Long,-$250,-11pts,11pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/u7F7Bq2z,"internal smt... targeting asiah... B",B,NO,NO,YES,,,
2-26-25,NQ,5:39:00 AM,Weds,BULL,Long,$0,0pts,12pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/MxY5U9bW,"internal smt... targeting m15 fvg-... B",B,NO,NO,YES,,,
2-27-25,NQ,10:30:00 AM,Weds,BULL,Long,$0,0pts,67pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/3CV905jp,"internal smt... targeting NYAM low... B",B,NO,NO,YES,,,
3-6-25,NQ,11:10:00 PM,Thurs,BEAR,Short,$0,0pts,9.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/7XzMoZCp,"internal smt... targeting asial... A",A,NO,NO,YES,,,
3-10-25,NQ,1:24:00 AM,Monday,BEAR,Short,$0,0pts,10.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/eV4hXqN8,"internal smt... targeting asial... A",A,NO,NO,YES,,,
3-10-25,NQ,8:54:00 PM,Monday,BEAR,Short,$0,0pts,28.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/TGSSPjVE,"internal smt... targeting asial... A",A,NO,NO,YES,,,
3-12-25,NQ,7:15:00 AM,Weds,BULL,Long,$0,0pts,23.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/xJsAJXLj,"internal smt... targeting m15 ob-... B",B,NO,YES,YES,,,
3-16-25,NQ,11:04:00 PM,Sun,BULL,Long,-$250,-12.5pts,12.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/eT7R85R0,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
3-17-25,NQ,3:16:00 AM,Monday,BEAR,Short,-$250,-23.5pts,23.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/0q0Ysqi8,"internal smt... targeting asial... A",A,NO,NO,NO,,,
3-18-25,NQ,4:43:00 AM,Tues,BULL,Long,-$250,-11.25pts,11.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/UmuveRzT,"internal smt... targeting asiah... A",A,NO,NO,YES,,,
3-19-25,NQ,6:00:00 AM,Weds,BULL,Long,$0,0pts,13.25pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/CcEETwAv,"internal smt 2x... targeting asiah... A",A,NO,NO,YES,,,
3-20-25,NQ,12:28:00 AM,Thurs,BULL,Long,$0,0pts,9.75pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/1uKJu1dT,"internal smt... targeting asiah... A-",A-,NO,YES,YES,,,
3-24-25,NQ,11:03:00 PM,Monday,BEAR,Short,-$250,-7.5pts,7.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/qpSBEOhr,"internal smt... targeting h4 fvg+... A-",A-,NO,YES,YES,,,
3-25-25,NQ,9:10:00 AM,Tues,BULL,Long,$0,0pts,54.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/yNm0AATW,"internal smt... targeting h4 bsl... A",A,NO,NO,YES,,,
3-25-25,NQ,5:50:00 AM,Fri,BEAR,Short,$0,0pts,11.5pts,SMT + IOB m1,1:2,0.50%,YES,https://www.tradingview.com/x/JlkBgLnB,"internal smt... targeting m15 fvg+... A",A,NO,NO,YES,,,`;

        let trades = [];

        function init() {
            const storedTrades = localStorage.getItem('abs_trades_v2');
            if (storedTrades) {
                trades = JSON.parse(storedTrades);
            } else {
                trades = parseCSV(initialCsvData);
                saveData();
            }
            updateUI();
            runMonteCarlo(); // Init Simulation
        }

        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const parsed = [];
            for (let i = 1; i < lines.length; i++) {
                const row = [];
                let inQuote = false;
                let currentStr = "";
                for(let char of lines[i]) {
                    if(char === '"') inQuote = !inQuote;
                    else if(char === ',' && !inQuote) { row.push(currentStr); currentStr = ""; }
                    else currentStr += char;
                }
                row.push(currentStr);
                if (row.length < 5) continue;

                let pl = parseFloat(row[6] ? row[6].replace(/[$,"]/g, '') : "0") || 0;
                let grade = "N/A";
                for(let k = row.length-1; k > 10; k--) {
                    const val = row[k] ? row[k].trim() : "";
                    if(['A', 'A-', 'B', 'B+', 'C'].includes(val)) { grade = val; break; }
                }
                let screenshot = row[13] || "";
                if(screenshot.includes("http")) screenshot = screenshot.split(' ')[0];

                parsed.push({
                    id: Date.now() + Math.random(),
                    date: row[0],
                    day: row[3],
                    bias: row[4],
                    type: row[5],
                    pl: pl,
                    setup: row[9],
                    screenshot: screenshot,
                    note: row[14] ? row[14].replace(/"/g, '') : "",
                    grade: grade
                });
            }
            return parsed;
        }

        function saveData() {
            localStorage.setItem('abs_trades_v2', JSON.stringify(trades));
            updateUI();
            runMonteCarlo();
        }

        function addTrade(e) {
            e.preventDefault();
            const dateInput = document.getElementById('inpDate').value;
            const dateObj = new Date(dateInput);
            const days = ['Sun', 'Monday', 'Tues', 'Weds', 'Thurs', 'Fri', 'Sat'];
            const month = dateObj.getMonth() + 1;
            const day = dateObj.getDate();
            const year = dateObj.getFullYear().toString().substr(-2);
            
            trades.unshift({
                id: Date.now(),
                date: `${month}-${day}-${year}`,
                day: days[dateObj.getDay()],
                bias: document.getElementById('inpBias').value,
                type: document.getElementById('inpType').value,
                pl: parseFloat(document.getElementById('inpPL').value),
                setup: document.getElementById('inpSetup').value,
                grade: document.getElementById('inpGrade').value,
                screenshot: document.getElementById('inpLink').value,
                note: document.getElementById('inpNote').value
            });
            saveData();
            closeModal();
            document.getElementById('tradeForm').reset();
        }

        function deleteTrade(id) {
            if(confirm('Delete trade?')) {
                trades = trades.filter(t => t.id !== id);
                saveData();
            }
        }

        // --- CHARTS & UI ---
        let equityChart, winrateChart, dayChart, monteCarloChart;

        function updateUI() {
            const totalProfit = trades.reduce((acc, t) => acc + t.pl, 0);
            const wins = trades.filter(t => t.pl > 0).length;
            const losses = trades.filter(t => t.pl < 0).length;
            const be = trades.filter(t => t.pl === 0).length;
            const total = trades.length;
            
            // KPI
            const pEl = document.getElementById('total-profit');
            pEl.textContent = `$${totalProfit.toLocaleString(undefined, {minimumFractionDigits: 2})}`;
            pEl.className = `text-4xl font-bold mt-2 ${totalProfit >= 0 ? 'text-success' : 'text-danger'}`;
            
            const grossProfit = trades.filter(t => t.pl > 0).reduce((a,t)=>a+t.pl,0);
            const grossLoss = Math.abs(trades.filter(t => t.pl < 0).reduce((a,t)=>a+t.pl,0));
            document.getElementById('profit-factor').textContent = `PF: ${grossLoss > 0 ? (grossProfit/grossLoss).toFixed(2) : ""}`;
            
            document.getElementById('winrate-text').textContent = total > 0 ? `${((wins/total)*100).toFixed(1)}%` : "0%";
            document.getElementById('total-wins').textContent = wins;
            document.getElementById('total-losses').textContent = losses;
            document.getElementById('total-be').textContent = be;
            
            const avgWin = wins > 0 ? grossProfit / wins : 0;
            const avgLoss = losses > 0 ? trades.filter(t => t.pl < 0).reduce((a,t)=>a+t.pl,0) / losses : 0;
            document.getElementById('avg-win').textContent = `$${avgWin.toFixed(2)}`;
            document.getElementById('avg-loss').textContent = `$${avgLoss.toFixed(2)}`;
            document.getElementById('total-trades').textContent = total;
            
            const winPct = total > 0 ? wins/total : 0;
            const lossPct = total > 0 ? losses/total : 0;
            document.getElementById('expectancy').textContent = `$${((winPct*avgWin)-(lossPct*Math.abs(avgLoss))).toFixed(2)}`;

            renderCharts(trades);
            renderTable(trades);
            renderGrades(trades);
        }

        function renderTable(data) {
            const tbody = document.getElementById('trades-table-body');
            tbody.innerHTML = '';
            data.forEach(t => {
                const row = document.createElement('tr');
                row.className = "bg-card border-b border-gray-800 hover:bg-gray-800 transition";
                const plClass = t.pl > 0 ? 'text-success' : (t.pl < 0 ? 'text-danger' : 'text-gray-400');
                const link = t.screenshot ? `<a href="${t.screenshot}" target="_blank" class="text-accent hover:text-blue-400"><i class="fa-solid fa-link"></i></a>` : '-';
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap">${t.date}</td>
                    <td class="px-4 py-3"><span class="px-2 py-1 rounded text-[10px] font-bold ${t.bias === 'BULL' ? 'bg-blue-900 text-blue-300' : 'bg-orange-900 text-orange-300'}">${t.bias}</span></td>
                    <td class="px-4 py-3">${t.setup} <span class="text-xs text-gray-500">(${t.grade})</span></td>
                    <td class="px-4 py-3 text-right font-mono font-bold ${plClass}">$${t.pl}</td>
                    <td class="px-4 py-3 text-center">${link}</td>
                    <td class="px-4 py-3 truncate max-w-[120px]" title="${t.note}">${t.note}</td>
                    <td class="px-4 py-3 text-center"><button onclick="deleteTrade(${t.id})" class="text-gray-600 hover:text-danger"><i class="fa-solid fa-trash"></i></button></td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderCharts(data) {
            // Equity
            const chronTrades = [...data].reverse();
            let runPL = 0;
            const eqData = chronTrades.map(t => { runPL += t.pl; return runPL; });
            if(equityChart) equityChart.destroy();
            equityChart = new Chart(document.getElementById('equityChart'), {
                type: 'line',
                data: { labels: chronTrades.map(t => t.date), datasets: [{ data: eqData, borderColor: '#3b82f6', backgroundColor: 'rgba(59,130,246,0.1)', borderWidth: 2, fill: true, pointRadius: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: {legend: {display: false}}, scales: {x: {display: false}, y: {grid: {color: '#334155'}}} }
            });

            // Winrate
            if(winrateChart) winrateChart.destroy();
            const w = data.filter(t=>t.pl>0).length, l = data.filter(t=>t.pl<0).length, be = data.filter(t=>t.pl===0).length;
            winrateChart = new Chart(document.getElementById('winrateChart'), {
                type: 'doughnut',
                data: { datasets: [{ data: [w, l, be], backgroundColor: ['#10b981', '#ef4444', '#64748b'], borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: {legend: {display: false}}, cutout: '75%' }
            });

            // Day
            if(dayChart) dayChart.destroy();
            const days = {}; data.forEach(t => days[t.day] = (days[t.day]||0) + t.pl);
            const dOrder = ['Monday', 'Tues', 'Weds', 'Thurs', 'Fri'];
            dayChart = new Chart(document.getElementById('dayChart'), {
                type: 'bar',
                data: { labels: dOrder.filter(d=>days[d]!==undefined), datasets: [{ data: dOrder.filter(d=>days[d]!==undefined).map(d=>days[d]), backgroundColor: d=>d.raw>=0?'#10b981':'#ef4444', borderRadius: 4 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: {legend: {display: false}}, scales: {y: {grid: {color: '#334155'}}, x: {grid: {display: false}}} }
            });
        }

        function renderGrades(data) {
            const stats = {};
            data.forEach(t => {
                const g = t.grade || "N/A";
                if(!stats[g]) stats[g] = {count:0, wins:0, pl:0};
                stats[g].count++; stats[g].pl += t.pl; if(t.pl > 0) stats[g].wins++;
            });
            const body = document.getElementById('grade-table-body'); body.innerHTML = '';
            Object.keys(stats).sort().forEach(g => {
                const s = stats[g];
                body.innerHTML += `<tr class="border-b border-gray-700"><td class="py-2 font-bold text-white">${g}</td><td class="py-2 text-right ${s.pl>0?'text-success':'text-danger'}">$${s.pl.toFixed(0)}</td><td class="py-2 text-right">${((s.wins/s.count)*100).toFixed(0)}%</td></tr>`;
            });
        }

        // --- MONTE CARLO SIMULATION LOGIC ---
        
        function calculateRMultiples() {
            // Determine Base Risk (Avg Loss)
            const losses = trades.filter(t => t.pl < 0).map(t => t.pl);
            const avgLoss = losses.length > 0 ? Math.abs(losses.reduce((a,b)=>a+b,0)/losses.length) : 250; // Default fallback
            
            // Convert Trades to R
            return trades.map(t => t.pl / avgLoss);
        }

        function getDailyDistribution() {
            // Group by Date to find trade frequency
            const dateCounts = {};
            trades.forEach(t => { dateCounts[t.date] = (dateCounts[t.date] || 0) + 1; });
            const counts = Object.values(dateCounts);
            return counts; // Array of [1, 2, 1, 3, ...] trades per day
        }

        function runMonteCarlo() {
            const riskPercent = parseFloat(document.getElementById('riskSlider').value);
            document.getElementById('riskDisplay').textContent = riskPercent.toFixed(2) + "%";

            const rMultiples = calculateRMultiples();
            const tradeCounts = getDailyDistribution();

            if(rMultiples.length === 0) return;

            const SIMULATIONS = 1000;
            const START_BAL = 50000;
            const TARGET = 53000;
            const TRAILING_DD = 2000;
            const MAX_DAILY_LOSS = 1000;
            const MAX_DAILY_GAIN_CAP = 1500;

            let results = []; // { passed: bool, days: int, curve: [] }
            let curves = [];

            for(let i=0; i<SIMULATIONS; i++) {
                let balance = START_BAL;
                let hwm = START_BAL;
                let days = 0;
                let curve = [START_BAL];
                let passed = false;
                let failed = false;

                // Run until Pass or Fail
                while(!passed && !failed && days < 100) { // Max 100 days cap to avoid infinite loops
                    days++;
                    
                    // 1. Determine trades for today
                    const numTrades = tradeCounts[Math.floor(Math.random() * tradeCounts.length)] || 1;
                    
                    let dailyPL = 0;
                    let dailyTradePLs = [];

                    // 2. Simulate Trades
                    for(let t=0; t<numTrades; t++) {
                        const r = rMultiples[Math.floor(Math.random() * rMultiples.length)];
                        const riskAmt = START_BAL * (riskPercent / 100); // Fixed risk based on initial balance
                        const tradePL = r * riskAmt;
                        dailyPL += tradePL;
                        
                        // Check Daily Loss Limit (Hard Stop)
                        if(dailyPL <= -MAX_DAILY_LOSS) {
                            failed = true; // Instant fail prop firm rule
                            break; 
                        }
                    }
                    
                    if(failed) break;

                    // 3. Apply Daily Cap
                    if(dailyPL > MAX_DAILY_GAIN_CAP) dailyPL = MAX_DAILY_GAIN_CAP;

                    // 4. Update Balance
                    balance += dailyPL;
                    curve.push(balance);

                    // 5. Update HWM & Check Trailing DD
                    if(balance > hwm) hwm = balance;
                    
                    // Trailing Drawdown Rule: Balance cannot fall below HWM - 2000
                    // (Note: Some firms lock trailing at start balance, simplified here to standard trailing)
                    if(balance < (hwm - TRAILING_DD)) {
                        failed = true;
                    }

                    // 6. Check Target
                    if(balance >= TARGET) {
                        passed = true;
                    }
                }
                
                results.push({ passed, days, curve });
                curves.push(curve);
            }

            // --- Process Results ---
            const passedRuns = results.filter(r => r.passed);
            const passRate = (passedRuns.length / SIMULATIONS) * 100;
            const avgDays = passedRuns.length > 0 ? passedRuns.reduce((a,b)=>a+b.days,0)/passedRuns.length : 0;
            
            // Get Median P/L outcome
            results.sort((a,b) => a.curve[a.curve.length-1] - b.curve[b.curve.length-1]);
            const medianRun = results[Math.floor(results.length/2)];

            // UI Updates
            document.getElementById('sim-pass-rate').textContent = `${passRate.toFixed(1)}%`;
            document.getElementById('sim-pass-rate').className = `text-3xl font-bold mt-1 ${passRate > 50 ? 'text-success' : 'text-danger'}`;
            document.getElementById('sim-avg-days').textContent = `${avgDays.toFixed(1)} Days`;
            document.getElementById('sim-median-pl').textContent = `$${(medianRun.curve[medianRun.curve.length-1] - START_BAL).toFixed(0)}`;

            drawMonteCarloChart(curves, START_BAL, TARGET);
        }

        function drawMonteCarloChart(allCurves, start, target) {
            // Sort curves by final value to find Percentiles
            allCurves.sort((a,b) => a[a.length-1] - b[b.length-1]);
            
            const worst = allCurves[Math.floor(allCurves.length * 0.05)]; // 5th percentile
            const median = allCurves[Math.floor(allCurves.length * 0.5)]; // 50th
            const best = allCurves[Math.floor(allCurves.length * 0.95)];  // 95th

            // Normalize lengths for chart (charts need same length labels usually, or scatter)
            // We will just plot up to max length of the chosen 3 lines
            const maxLength = Math.max(worst.length, median.length, best.length);
            const labels = Array.from({length: maxLength}, (_, i) => `Day ${i}`);

            if(monteCarloChart) monteCarloChart.destroy();
            
            monteCarloChart = new Chart(document.getElementById('monteCarloChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Best 5%',
                            data: best,
                            borderColor: '#10b981',
                            borderWidth: 2,
                            pointRadius: 0,
                            tension: 0.4
                        },
                        {
                            label: 'Median',
                            data: median,
                            borderColor: '#3b82f6',
                            borderWidth: 2,
                            pointRadius: 0,
                            tension: 0.4
                        },
                        {
                            label: 'Worst 5%',
                            data: worst,
                            borderColor: '#ef4444',
                            borderWidth: 2,
                            pointRadius: 0,
                            tension: 0.4
                        },
                        {
                            label: 'Target',
                            data: Array(maxLength).fill(target),
                            borderColor: 'rgba(255,255,255,0.2)',
                            borderDash: [5, 5],
                            borderWidth: 1,
                            pointRadius: 0
                        },
                        {
                            label: 'Max DD (Approx)',
                            data: Array(maxLength).fill(start - 2000), // Rough visual guide
                            borderColor: 'rgba(239, 68, 68, 0.2)',
                            borderDash: [5, 5],
                            borderWidth: 1,
                            pointRadius: 0
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: { intersect: false, mode: 'index' },
                    plugins: { legend: { display: false }, tooltip: { enabled: true } },
                    scales: {
                        x: { display: false },
                        y: { 
                            grid: { color: '#334155' },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }

        // Utils
        function openModal() { document.getElementById('tradeModal').classList.replace('hidden', 'flex'); }
        function closeModal() { document.getElementById('tradeModal').classList.replace('flex', 'hidden'); }
        document.getElementById('tradeForm').addEventListener('submit', addTrade);
        
        document.getElementById('search').addEventListener('keyup', (e) => {
            const term = e.target.value.toLowerCase();
            document.querySelectorAll('#trades-table-body tr').forEach(row => {
                row.style.display = row.innerText.toLowerCase().includes(term) ? '' : 'none';
            });
        });

        function exportData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(trades));
            const node = document.createElement('a');
            node.setAttribute("href", dataStr);
            node.setAttribute("download", "abs_trading_journal.json");
            document.body.appendChild(node); node.click(); node.remove();
        }

        function importData(input) {
            const file = input.files[0];
            if(!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const json = JSON.parse(e.target.result);
                    if(Array.isArray(json)) { trades = json; saveData(); alert('Data restored!'); }
                } catch(err) { alert('Error reading file'); }
            };
            reader.readAsText(file);
        }

        init();

    </script>
</body>
</html>
